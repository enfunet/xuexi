---
import fs from 'fs';
import path from 'path';
import { Astro } from 'astro';

// ✅ 告诉 Astro 所有文章 ID → 用于生成静态页面
export async function getStaticPaths() {
  const dataPath = path.resolve('./notion/data/all.json');
  const raw = fs.readFileSync(dataPath, 'utf-8');
  const posts = JSON.parse(raw);

  return posts.map(post => ({
    params: { id: post.id },
  }));
}

// ✅ 页面正常加载
const dataPath = path.resolve('./notion/data/all.json');
const raw = fs.readFileSync(dataPath, 'utf-8');
const posts = JSON.parse(raw);

const { params } = Astro;
const post = posts.find(p => p.id === params.id);

if (!post) {
  throw new Error('找不到文章');
}
---

<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>{post.title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
  /* 页面背景和字体 */
  body {
    font-family: 'Arial', sans-serif;
    line-height: 1.8;
    padding: 2rem;
    background-color: #f7f7f7;
    color: #333;
  }

  h1, h2, h3, h4 {
    color: #e86a24;
    font-weight: 600;
  }

  p, li {
    font-size: 1rem;
    margin-bottom: 1em;
  }

  /* 列表 */
  ul, ol {
    padding-left: 2em;
  }

  /* 引用 */
  blockquote {
    background: #f4f4f4;
    padding: 1em;
    border-left: 4px solid #ccc;
    font-style: italic;
    margin-bottom: 1em;
  }

  /* 高亮、颜色 */
  span[style*="color"] {
    color: #e86a24;
  }

  span[style*="background-color"] {
    background-color: #f2f2f2;
  }

  /* 代码块 */
  code {
    background: #f0f0f0;
    padding: 0.2em 0.4em;
    border-radius: 4px;
    font-family: monospace;
  }

  /* 图片 */
  img {
    max-width: 100%;
    margin: 1em 0;
    display: block;
    border-radius: 8px;
  }

  /* Toggle 展开样式 */
  details {
    background: #fff;
    border: 1px solid #ddd;
    padding: 1em;
    border-radius: 5px;
    margin-bottom: 1.5em;
  }

  summary {
    font-weight: bold;
    cursor: pointer;
    font-size: 1.1rem;
    color: #e86a24; /* 默认颜色 */
  }

  /* 让 Toggle 展开时标题的颜色改变 */
  details[open] summary {
    color: #d36222; /* 展开后的颜色 */
  }

  /* Hover 效果 */
  summary:hover {
    color: #d36222;
  }

  /* 可选：增加动画效果 */
  details {
    transition: all 0.3s ease;
  }

  /* Callout 提示框 */
  .callout {
    background: #fff8e1;
    padding: 1em;
    border-left: 5px solid #e86a24;
    margin: 1em 0;
    border-radius: 5px;
  }

  /* 分割线 */
  hr {
    border: 0;
    height: 1px;
    background: #ddd;
    margin: 2em 0;
  }

  /* 响应式设计 */
  @media screen and (max-width: 768px) {
    body {
      padding: 1rem;
    }

    h1, h2, h3 {
      font-size: 1.2rem;
    }

    p {
      font-size: 1rem;
    }
  }

  /* 图片自适应 */
  img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: 8px;
    margin-top: 1em;
    margin-bottom: 1em;
  }
</style>

  </head>
  <body>
    <a href="/">← 返回首页</a>
    <h1>{post.title}</h1>
    <p>{post.category} / {post.subcategory} | {post.date}</p>
    <img src={post.cover} alt="封面图" style="max-width: 100%; margin: 1rem 0;" />
    <div>
      <div set:html={post.content}></div>
    </div>
  </body>
</html>
